<div class="ml-appointment-history bg-dark cardcontainer">

  <div class="cold-md-10 mx-auto my-5 card bg-dark">

    <div class="text-center mt-3">
      <h2 data-cy="AppointmentHeading">
        Appointments
      </h2>
    </div>
    <div class="alert alert-warning" id="no-result" *ngIf="!appointments?.length">
      <span mediTranslate="medilabApp.appointment.home.notFound">No appointment found</span>
    </div>

    <div class="table-responsive bg-dark" id="entities" *ngIf="appointments && appointments.length > 0">
      <table class="table table-striped" aria-describedby="page-heading">
        <thead>
          <tr>
            <th scope="col">
              <span mediTranslate="medilabApp.appointment.date">
                Date
              </span>
            </th>
            <th scope="col">
              <span mediTranslate="medilabApp.appointment.status">
                Status
              </span>
            </th>
            <th scope="col" *ngIf="account?.authorities?.includes('ROLE_USER') 
        || account?.authorities?.includes('ROLE_ADMIN')">
              <span mediTranslate="medilabApp.appointment.patient">
                Patient
              </span>
            </th>
            <th scope="col" *ngIf="account?.authorities?.includes('ROLE_PATIENT')">
              <span mediTranslate="medilabApp.appointment.specialist">
                Doctor
              </span>
            </th>
            <th scope="col" *ngIf="account?.authorities?.includes('ROLE_USER')
        || account?.authorities?.includes('ROLE_ADMIN')"></th>
          </tr>
        </thead>
        <tbody class="list-display">
          <tr *ngFor="let appointment of appointments; trackBy: trackId" data-cy="entityTable">

            <td *ngIf="((appointment.patient?.id === patient?.id )
      || (appointment.doctor?.id === doctor?.id)
      || (account?.authorities?.includes('ROLE_ADMIN')))
      && (appointment.status !== 'PENDING')">
              <div [ngSwitch]="appointment?.status">
                <svg *ngSwitchCase="'CANCELED'" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                  fill="currentColor" class="bi bi-calendar-x" viewBox="0 0 16 16">
                  <path
                    d="M6.146 7.146a.5.5 0 0 1 .708 0L8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 0 1 0-.708z" />
                  <path
                    d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                </svg>
                <svg *ngSwitchCase="'PAID'" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                  fill="currentColor" class="bi bi-calendar-check-fill" viewBox="0 0 16 16">
                  <path
                    d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2zm-5.146-5.146-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708z" />
                </svg>
                <svg *ngSwitchDefault xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-calendar-check" viewBox="0 0 16 16">
                  <path
                    d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z" />
                  <path
                    d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                </svg>
                {{ appointment.date | formatMediumDate }}
              </div>
            </td>

            <td mediTranslate="{{ 'medilabApp.Status.' + appointment.status }}" *ngIf="((appointment.patient?.id === patient?.id )
           || (appointment.doctor?.id === doctor?.id)
           || (account?.authorities?.includes('ROLE_ADMIN')))
           && (appointment.status !== 'PENDING')">
              {{ appointment.status }}
            </td>


            <td *ngIf="((appointment.doctor?.id === doctor?.id)
      && (account?.authorities?.includes('ROLE_USER'))
      || (account?.authorities?.includes('ROLE_ADMIN')))
      && (appointment.status !== 'PENDING')">
              <div *ngIf="appointment.patient">
                {{ searchPatientFullName(appointment.patient) }}
                {{ appointment.patient?.secondSurname }}
              </div>
            </td>

            <td *ngIf="((appointment.patient?.id === patient?.id)
      && (account?.authorities?.includes('ROLE_PATIENT')))
      && (appointment.status !== 'PENDING')">
              <div *ngIf="appointment.doctor">
                {{ searchDoctorFullName(appointment.doctor) }}
              </div>
            </td>
            <td class="text-right" *ngIf="((appointment.patient?.id === patient?.id )
            || (appointment.doctor?.id === doctor?.id)
            || account?.authorities?.includes('ROLE_ADMIN'))
            && (appointment.status !== 'PENDING')">
              <a class="btn btn-secondary btn-sm mr-1" mediTranslate="medilabApp.appointment.appointmentDetail"
                [routerLink]="['/main/appointment', appointment.id, 'view']">
                Detalle
              </a>
              <button 
              class="btn btn-primary btn-sm mr-1" 
              mediTranslate="medilabApp.appointment.viewPatient"
                [routerLink]="['/main/patient', appointment.patient?.id, 'view']"
                *ngIf="account?.authorities?.includes('ROLE_ADMIN')
                || account?.authorities?.includes('ROLE_USER')">
                View Patient
              </button>

              <button 
              class="btn btn-primary btn-sm mr-1" 
              mediTranslate="medilabApp.appointment.viewDoctor"
                [routerLink]="['/main/doctor', appointment.doctor?.id, 'view']"
                *ngIf="account?.authorities?.includes('ROLE_ADMIN')
                || account?.authorities?.includes('ROLE_PATIENT')">
                View Patient
              </button>
            </td>

          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>