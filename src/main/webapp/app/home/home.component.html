<div class="ml-profile">
  <div class="container">
    <div class="mb-4">
      <!-- open profile top section -->
      <section class="ml-profile__top">
        <!-- open top left card -->
        <div class="card bg-dark">
          <h5 class="card-header" *ngIf="account?.authorities?.includes('ROLE_PATIENT')">
            <span mediTranslate="home.welcome">Bienvenido: </span>
            <span class="ml-profile__user-text">{{ account?.firstName }} {{ account?.lastName }} {{ patient?.secondSurname }}</span>
          </h5>
          <h5 class="card-header" *ngIf="account?.authorities?.includes('ROLE_ADMIN') || account?.authorities?.includes('ROLE_USER')">
            <span mediTranslate="home.welcome">Bienvenido: </span>
            <span class="ml-profile__user-text">{{ account?.firstName }} {{ account?.lastName }}</span>
          </h5>
          <div class="card-body">
            <!-- START Top left card / Patient Block -->
            <div *ngIf="account?.authorities?.includes('ROLE_PATIENT')">
              <!-- <a href="#" class="btn btn-secondary" mediTranslate="home.viewLastAppointment" [routerLink]="['/appointment/1/view']">
                Ver última cita
              </a> -->
              <a
                target="_blank"
                class="btn btn-secondary"
                mediTranslate="home.requestAppointment"
                href="https://wa.me/50688885353?text=Solicito%20una%20cita%20con%20el%20doctor"
              >
                Solicitar una cita
              </a>
            </div>
            <!-- END Top left card / Patient Block -->
            <!-- START Top left card / Doctor Block -->
            <div *ngIf="account?.authorities?.includes('ROLE_USER')">
              <button
                id="jh-create-entity"
                data-cy="entityCreateButton"
                class="btn btn-primary jh-create-entity create-appointment"
                [routerLink]="['/main/appointment/new']"
              >
                <fa-icon icon="plus"></fa-icon>
                <span mediTranslate="home.createNewAppointment">Crear una nueva cita</span>
              </button>
            </div>
            <!-- END Top left card / Doctor Block -->
          </div>
          <!-- close card body -->
        </div>
        <!-- close top left card -->

        <!-- open user profile -->
        <div class="card bg-dark">
          <medi-user-profile [user]="currentUser"></medi-user-profile>
        </div>
        <!-- close user profile -->
      </section>
      <!-- close profile top section -->
      <!-- open profile bottom or body section -->
      <section class="ml-profile__bottom">
        <!-- START body patient Block -->
        <div class="mt-3" *ngIf="account?.authorities?.includes('ROLE_PATIENT')">
          <div class="card bg-dark mb-3">
            <h5 class="card-header" mediTranslate="home.upcomingAppointments">Próximas citas</h5>
            <div class="card-body">
              <ul class="list-group ml-profile__agenda">
                <li class="list-group-item" *ngFor="let appointment of appointmentsPatient; let i = index">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    class="bi bi-calendar"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"
                    />
                  </svg>
                  <div class="ml-profile__agenda-data">
                    <time>{{ appointment.date | date }}</time>
                    <div class="ml-profile__appointment-doctor-info">
                      <b class="mr-2">Dr. {{ appointment.doctor?.completeName }}</b>
                      <span class="badge bg-primary">{{ appointment.doctor?.specialty }}</span>
                    </div>
                  </div>
                  <a
                    class="btn btn-secondary btn-sm mr-1"
                    mediTranslate="home.appointmentDetail"
                    [routerLink]="['/main/appointment', appointment.id, 'view']"
                  >
                    Detalle
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <!--AILMENT-->
          <div class="card bg-dark mb-3">
            <h5 class="card-header" mediTranslate="home.ailments">Padecimientos</h5>
            <div class="card-body">
              <ul class="list-group ml-ailment">
                <li class="list-group-item" *ngFor="let ailment of ailmentsPatient; let i = index">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    class="bi bi-bag-plus"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M8 7.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0v-1.5H6a.5.5 0 0 1 0-1h1.5V8a.5.5 0 0 1 .5-.5z"
                    />
                    <path
                      d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5z"
                    />
                  </svg>
                  <div class="ml-ailment-data">
                    <b>{{ ailment.ailment.name }}</b>
                  </div>
                  <button class="btn btn-secondary btn-sm mr-1" (click)="openAilmentModal(addAilmentModal, ailment)">Detalle</button>
                </li>
              </ul>
            </div>
          </div>

          <div class="card bg-dark">
            <h5 class="card-header">
              <span mediTranslate="medilabApp.emergencyContact.home.title" class="m-0 p-0">Contact(s) en caso de una emergencia</span>

              <div class="d-flex justify-content-end m-0 p-0">
                <button
                  *ngIf="emergencyContactsTotal < 3"
                  (click)="showCreateContactModal()"
                  id="createContact"
                  data-cy="entityCreateButton"
                  class="btn btn-primary"
                >
                  <fa-icon icon="plus"></fa-icon>
                  <span mediTranslate="home.btnNewContact"> Create a new Ailment </span>
                </button>
              </div>
            </h5>
            <div class="card-body">
              <div class="alert alert-warning" id="no-result" *ngIf="emergencyContacts?.length === 0">
                <span mediTranslate="medilabApp.emergencyContact.home.notFound">No emergencyContacts found</span>
              </div>
              <div class="table-responsive" id="entities" *ngIf="emergencyContacts && emergencyContacts.length > 0">
                <table class="table table-striped" aria-describedby="page-heading">
                  <thead>
                    <tr>
                      <th scope="col"><span mediTranslate="medilabApp.emergencyContact.name">Name</span></th>
                      <th scope="col"><span mediTranslate="medilabApp.emergencyContact.phone">Phone</span></th>
                      <th scope="col"><span mediTranslate="medilabApp.emergencyContact.email">Email</span></th>
                      <th scope="col"><span mediTranslate="medilabApp.emergencyContact.relationShip">Relationship</span></th>
                      <th scope="col"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let emergencyContact of emergencyContacts; trackBy: trackId" data-cy="entityTable">
                      <td *ngIf="emergencyContact.patient">{{ emergencyContact.name }}</td>
                      <td *ngIf="emergencyContact.patient">{{ emergencyContact.phone }}</td>
                      <td *ngIf="emergencyContact.patient">{{ emergencyContact.email }}</td>
                      <td *ngIf="emergencyContact.patient">{{ emergencyContact.relationShip }}</td>
                      <td class="text-right" *ngIf="emergencyContact.patient">
                        <div class="btn-group">
                          <button
                            type="submit"
                            (click)="showModifyContactModal(emergencyContact)"
                            class="btn btn-primary btn-sm"
                            data-cy="entityEditButton"
                          >
                            <fa-icon icon="pencil-alt"></fa-icon>
                            <span class="d-none d-md-inline" mediTranslate="entity.action.edit">Edit</span>
                          </button>
                          <button
                            *ngIf="emergencyContactsTotal > 1"
                            type="submit"
                            (click)="deleteEmergencyContact(emergencyContact)"
                            class="btn btn-danger btn-sm"
                            data-cy="entityDeleteButton"
                          >
                            <fa-icon icon="times"></fa-icon>
                            <span class="d-none d-md-inline" mediTranslate="entity.action.delete">Delete</span>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- END body patient Block -->

        <!-- START body doctor Block -->
        <div class="card bg-dark mt-3" *ngIf="account?.authorities?.includes('ROLE_USER')">
          <h5 class="card-header" mediTranslate="home.upcomingAppointments">Próximas citas</h5>
          <div class="card-body">
            <ul class="list-group ml-profile__agenda">
              <li class="list-group-item" *ngFor="let appointment of appointmentsDoctor; let i = index" [id]="i">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-calendar"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"
                  />
                </svg>
                <div class="ml-profile__agenda-data">
                  <time>{{ appointment.date | date }}</time>
                  <div class="ml-profile__appointment-patient-info">
                    <b class="mr-4">{{ appointment.patient?.internalUser.completeName }} {{ appointment.patient?.secondSurname }}</b>
                    <span class="badge bg-secondary">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        fill="currentColor"
                        class="bi bi-phone"
                        viewBox="0 0 16 16"
                      >
                        <path
                          d="M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h6zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H5z"
                        />
                        <path d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                      </svg>
                      {{ appointment.patient?.phone }}
                    </span>
                  </div>
                </div>
                <div class="ml-profile__appointment-patient-info-ctas">
                  <a
                    class="btn btn-secondary btn-sm mr-1"
                    mediTranslate="home.appointmentDetail"
                    [routerLink]="['/main/appointment', appointment.id, 'view']"
                  >
                    Detalle
                  </a>
                  <button
                    class="btn btn-primary btn-sm"
                    mediTranslate="home.viewPatient"
                    [routerLink]="['/main/patient', appointment.patient.id, 'view']"
                  >
                    View Patient
                  </button>
                  <button
                    class="btn btn-warning btn-sm mr-1"
                    mediTranslate="home.appointmentDateChange"
                    (click)="openChangeDateModal(changeDateModal, i)"
                  >
                    Cambiar fecha
                  </button>
                  <button class="btn btn-danger btn-sm" mediTranslate="home.appointmentDelete" (click)="cancelAppointment(appointment)">
                    Cancelar cita
                  </button>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <!-- END body doctor Block -->
      </section>
    </div>
  </div>
  <!-- closes bootstrap container -->
</div>

<ng-template #changeDateModal>
  <div class="change-date-modal">
    <div class="mt-3">
      <div class="card bg-dark">
        <h5 class="card-header" mediTranslate="home.appointmentDateChangeModal.title">Cambiar la fecha de la cita</h5>
        <div class="card-body">
          <form>
            <div class="form-group">
              <div class="input-group">
                <input
                  class="form-control"
                  [formControl]="updatedDate"
                  placeholder="dd/mm/yyyy"
                  name="dp"
                  ngbDatepicker
                  #dateDp="ngbDatepicker"
                />
                <span class="input-group-append">
                  <button type="button" class="btn btn-secondary" (click)="dateDp.toggle()">
                    <fa-icon icon="calendar-alt"></fa-icon>
                  </button>
                </span>
              </div>
              <div class="change-date-modal__button-container">
                <button type="button" class="btn btn-primary" (click)="handleChangeDate()">Cambiar</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #addAilmentModal let-modal>
  <div>
    <div class="mt-3">
      <div class="card bg-dark mb-3">
        <h5 class="card-header" mediTranslate="medilabApp.appointmentTreatmentAilment.diagnosis">Diagnóstico detallado</h5>
        <div class="card-body">
          <ul class="list-group ml-profile__agenda">
            <li class="list-group-item">
              <div class="modal_card">
                <div class="modal_data_info">
                  <b class="mr-2" mediTranslate="medilabApp.appointmentTreatmentAilment.date">Fecha</b>
                </div>
                <span class="badge bg-secondary" id="details">{{ ailment.appointment.date }}</span>
              </div>
            </li>
            <li class="list-group-item">
              <div class="modal_card">
                <div class="modal_data_info">
                  <b class="mr-2" mediTranslate="medilabApp.appointmentTreatmentAilment.ailment">Padecimiento</b>
                </div>
                <span class="badge bg-secondary" id="details">{{ ailment.ailment.name }}</span>
              </div>
            </li>
            <li class="list-group-item">
              <div class="modal_card">
                <div class="modal_data_info">
                  <b class="mr-2" mediTranslate="medilabApp.appointmentTreatmentAilment.treatment">Tratamiento</b>
                </div>
                <span class="badge bg-secondary" id="details">{{ ailment.treatment.medicines }}</span>
              </div>
            </li>
            <li class="list-group-item">
              <div class="modal_card">
                <div class="modal_data_info">
                  <b class="mr-2" mediTranslate="medilabApp.appointmentTreatmentAilment.duration">Duración</b>
                </div>
                <span class="badge bg-secondary" id="details">{{ ailment.treatment.duration }}</span>
              </div>
            </li>
            <li class="list-group-item">
              <div class="modal_card">
                <div class="modal_data_info">
                  <b class="mr-2" mediTranslate="medilabApp.appointmentTreatmentAilment.specification">Especificación</b>
                </div>
                <span class="badge bg-secondary" id="details">{{ ailment.treatment.specifications }}</span>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</ng-template>
